# 校园维护与管理系统 (CMMS)

## 项目简介

校园维护与管理系统是一个基于Java开发的桌面应用程序，用于全面管理校园内的各类维护活动、人员安排、监督关系和数据统计分析。系统采用MVC架构设计，提供直观的用户界面和完善的功能模块，旨在提高校园维护工作的效率、透明度和管理水平。系统支持多种用户角色，实现了基于角色的权限控制，确保不同用户只能访问其权限范围内的功能。

## 项目结构

项目采用经典的MVC（Model-View-Controller）架构设计，代码组织清晰：
TiDB/
├── src/main/java/com/polyu/cmms/   # 主源码目录
│   ├── Main.java                    # 程序入口
│   ├── controller/                  # 控制器层
│   ├── model/                       # 数据模型层
│   │   ├── Activity.java            # 活动模型
│   │   ├── Staff.java               # 员工模型
│   │   └── WorksFor.java            # 员工-活动关联模型
│   ├── service/                     # 业务逻辑层
│   │   ├── ActivityService.java     # 活动管理服务
│   │   ├── StaffService.java        # 员工管理服务
│   │   ├── AuthService.java         # 权限认证服务
│   │   └── ...                      # 其他服务类
│   ├── util/                        # 工具类
│   │   ├── DatabaseUtil.java        # 数据库工具
│   │   ├── HtmlLogger.java          # 日志工具
│   │   └── createdata/              # 数据初始化工具
│   └── view/                        # 视图层
│       ├── MainFrame.java           # 主窗口
│       ├── ActivityManagementPanel.java # 活动管理面板
│       ├── StaffManagementPanel.java   # 人员管理面板
│       └── ...                      # 其他界面面板
├── pom.xml                          # Maven配置文件
└── README.md                        # 项目说明文档


## 技术栈

- **开发语言**: Java 24
- **GUI框架**: Java Swing
- **数据库**: MySQL/TiDB
- **JDBC驱动**: mysql-connector-j 8.4.0
- **构建工具**: Maven
- **版本控制**: Git

## 核心功能模块

### 1. 活动管理

- **活动全生命周期管理**：创建、编辑、删除各类校园维护活动
- **活动状态追踪**：支持活动状态更新，自动记录完成时间
- **员工智能分配**：根据活动需求和员工技能进行人员分配
- **详细信息展示**：活动详情、历史记录完整展示
- **不可用地点管理**：实时查看和管理因活动导致的不可用校园设施
- **多维度查询**：按活动类型、日期、状态、优先级等条件筛选查询
- **分页浏览**：支持大量活动数据的分页显示，提升浏览体验

### 1.1 活动类型支持

系统支持多种校园维护活动类型，包括但不限于：
- 日常清洁（Cleaning）
- 深度清洁（Deep Cleaning）
- 设施维修（Maintenance）
- 安全检查（Safety Inspection）
- 环境绿化（Landscaping）

### 1.2 活动状态管理

活动状态流转包括：
- 计划中（Planned）
- 进行中（In Progress）
- 已完成（Completed）
- 已取消（Cancelled）

当活动状态更新为"已完成"时，系统会自动记录实际完成时间。

### 2. 人员管理

- **员工信息全生命周期管理**：添加、更新、删除员工信息
- **详细员工档案**：记录员工基本信息、联系信息、工作信息和紧急联系人
- **多条件智能搜索**：支持按员工编号、姓名、性别、角色、状态等条件组合查询
- **分页浏览**：支持大量员工数据的分页显示和排序
- **员工状态管理**：激活/停用员工账号，灵活管理员工在职状态

### 2.1 员工监督关系管理

- **层级结构可视化**：树形结构直观展示管理层级关系
- **灵活的监督关系设置**：支持建立和管理员工间的上下级监督关系
- **时间限制管理**：为监督关系设置开始和结束日期
- **实时更新**：监督关系变更后即时反映在系统中

### 2.2 员工统计分析

- **总体人员统计**：实时显示系统中激活的员工总数
- **角色分布统计**：按角色类型统计员工数量和占比
- **性别分布统计**：按性别统计员工数量和占比
- **数据可视化**：表格形式直观展示各类统计数据

### 3. 数据管理与统计分析

- **校园设施数据管理**：维护建筑物、房间、楼层、广场、大门、食堂等设施信息
- **区域与位置管理**：精确记录活动和设施的位置信息
- **工作量统计**：按区域和活动类型统计员工参与数量
- **清洁活动专项统计**：按时间段和建筑物统计清洁活动情况
- **实时数据更新**：所有统计数据实时反映系统最新状态

## 权限管理

系统实现了基于角色的访问控制（RBAC），确保不同职责的用户只能访问其权限范围内的功能：

### 权限列表

- `MANAGE_STAFF`: 管理员工信息权限（添加、编辑、删除员工）
- `VIEW_STAFF`: 查看员工信息权限
- `MANAGE_ACTIVITY`: 管理活动权限（创建、编辑、删除活动）
- `VIEW_ACTIVITY`: 查看活动权限
- `VIEW_REPORT`: 查看报表权限
- `GENERATE_REPORT`: 生成报表权限

### 权限控制实现

- **动态UI显示**：根据用户权限动态显示/隐藏功能按钮
- **操作权限验证**：执行敏感操作前进行权限检查
- **数据访问控制**：限制用户只能访问其权限范围内的数据
- **权限继承机制**：高级权限自动包含低级权限

## 数据模型

### 核心实体

1. **Staff（员工）**
   - 基本信息：员工ID、员工编号、姓名、年龄、性别、出生日期
   - 工作信息：角色、入职日期、联系电话、邮箱、职责描述
   - 状态信息：是否在职（active_flag）
   - 紧急联系人：紧急联系人姓名、联系电话

2. **Activity（活动）**
   - 基本信息：活动ID、活动类型、标题、描述
   - 时间信息：计划日期时间、预计耗时、实际完成时间
   - 位置信息：建筑物ID、区域ID、房间ID、楼层ID等
   - 状态信息：状态、优先级、危险级别
   - 其他信息：创建人ID、天气ID、设施类型

3. **WorksFor（员工-活动关联）**
   - 记录员工与活动的分配关系
   - 包含活动职责描述
   - 支持一对多和多对多的灵活关联

4. **监督关系**
   - 记录员工间的上下级监督关系
   - 包含开始日期和结束日期
   - 支持层级化管理

## 日志系统

系统集成了功能完善的HtmlLogger日志系统，确保所有关键操作都有迹可循：

- **全面的操作记录**：记录用户登录/登出、数据增删改查等所有关键操作
- **详细的上下文信息**：包含操作时间、操作人、操作类型、操作对象等
- **错误和异常追踪**：记录系统错误和异常信息，便于问题排查
- **HTML格式存储**：日志以结构化HTML格式保存，支持浏览器直接查看
- **日期化命名**：日志文件按日期命名（如log_2025-11-24.html），方便归档和检索

日志文件默认保存在项目根目录下的logs文件夹中。

## 数据库连接

系统采用灵活的数据库连接管理机制，确保数据操作的高效性和可靠性：

- **统一的连接管理**：通过DatabaseUtil工具类集中管理数据库连接
- **多数据库支持**：兼容MySQL和TiDB数据库
- **参数化查询**：使用参数化SQL语句，防止SQL注入攻击
- **错误处理机制**：完善的异常捕获和处理，确保系统稳定性
- **批量操作支持**：支持批量数据插入和更新，提高处理效率
- **配置灵活性**：数据库连接参数可在util包中轻松修改

## 安装与运行

### 前置条件

- JDK 24或更高版本
- Maven 3.6+（用于构建项目）
- MySQL 8.0或TiDB 6.0+数据库
- 足够的内存和磁盘空间（建议至少4GB RAM，10GB磁盘空间）

### 构建步骤

1. **克隆项目到本地**
   ```bash
   git clone <项目仓库地址>
   cd TiDB
   ```

2. **配置数据库连接**
   - 打开`src/main/java/com/polyu/cmms/util/DatabaseUtil.java`
   - 修改数据库连接参数（URL、用户名、密码）

3. **初始化数据库表**
   - 运行`src/main/java/com/polyu/cmms/util/createdata`目录下的初始化脚本
   - 确保所有必要的表结构和初始数据已创建

4. **编译项目**
   ```bash
   mvn clean compile
   ```

5. **打包项目**
   ```bash
   mvn package
   ```

6. **运行程序**
   ```bash
   java -jar target/TiDB-1.0-SNAPSHOT.jar
   ```

### 开发环境配置

推荐使用以下开发工具：
- **IDE**：IntelliJ IDEA Ultimate或Community（推荐），或Eclipse
- **版本控制**：Git客户端（如GitKraken、SourceTree或IDE内置Git工具）
- **数据库工具**：MySQL Workbench或Navicat（用于数据库管理）

导入项目步骤：
1. 在IDE中选择"Import Project"
2. 选择项目的pom.xml文件
3. 按照Maven项目导入向导完成导入

### 环境变量配置（可选）

对于生产环境，建议通过环境变量配置数据库连接信息，提高安全性：

```bash
# Windows环境
set DB_URL=jdbc:mysql://localhost:3306/cmms
export DB_USERNAME=username
export DB_PASSWORD=password

# Linux/Mac环境
export DB_URL=jdbc:mysql://localhost:3306/cmms
export DB_USERNAME=username
export DB_PASSWORD=password
```

## 注意事项与最佳实践

### 系统部署注意事项

1. **数据库初始化**：首次运行前必须初始化数据库表结构和基础数据
2. **连接配置**：确保数据库连接信息准确无误，包括URL、用户名和密码
3. **权限设置**：确保数据库用户拥有足够的权限（SELECT、INSERT、UPDATE、DELETE）
4. **日志目录权限**：确保应用程序对logs目录有写权限

### 性能优化建议

1. **索引优化**：为常用查询字段创建适当的索引
2. **连接池配置**：在生产环境中配置连接池，提高数据库连接效率
3. **分页参数调整**：根据实际数据量调整pageSize参数，平衡性能和用户体验
4. **定期清理日志**：定期归档或清理旧日志文件，避免磁盘空间占用过大

### 安全最佳实践

1. **密码管理**：避免在代码中硬编码数据库密码
2. **权限控制**：严格按照最小权限原则分配用户权限
3. **输入验证**：所有用户输入必须经过验证，防止注入攻击
4. **定期备份**：定期备份数据库，防止数据丢失

### 故障排查指南

1. **连接问题**：检查数据库服务是否运行，连接参数是否正确
2. **权限错误**：确认当前用户拥有所需的操作权限
3. **性能问题**：查看日志文件中的耗时操作，优化SQL查询
4. **数据一致性**：定期验证数据完整性，确保关联数据的一致性

## 系统扩展性

系统设计考虑了良好的扩展性，可以通过以下方式进行功能扩展：

1. **新增活动类型**：通过修改活动类型枚举和相关UI组件
2. **添加新的报表类型**：扩展统计服务和视图组件
3. **集成外部系统**：通过API接口与其他校园管理系统集成
4. **增强用户界面**：替换或升级现有UI组件，提升用户体验

## 技术实现亮点

1. **单例模式**：所有服务类采用单例模式，确保资源高效利用
2. **参数化查询**：全面使用参数化SQL，防止SQL注入
3. **错误处理机制**：完善的异常捕获和日志记录，提高系统稳定性
4. **模块化设计**：功能模块高度内聚，便于维护和扩展
5. **分页机制**：高效的分页查询实现，支持大量数据的流畅浏览
6. **动态UI渲染**：根据用户权限动态调整界面元素显示

## 未来功能规划

1. **移动端支持**：开发移动应用，支持随时随地管理和查看活动
2. **实时通知**：集成消息推送系统，实现活动状态变更的实时通知
3. **预测性维护**：基于历史数据实现设备故障预测
4. **报表导出**：支持将报表导出为Excel、PDF等多种格式
5. **多语言支持**：增加英文、繁体中文等多语言界面支持
